@model RateFlix.Models.ViewModels.Admin.AdminAnalyticsViewModel
@{
    ViewData["Title"] = "Analytics";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<!-- Header -->
<div class="mb-8">
    <h1 class="text-3xl font-bold text-white mb-2">Review Analytics</h1>
    <p class="text-gray-400">Insights and statistics about user reviews</p>
</div>

<!-- Summary Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 shadow-lg">
        <div class="flex items-center justify-between mb-2">
            <i class="fas fa-comments text-3xl text-white opacity-75"></i>
            <span class="text-4xl font-bold text-white">@Model.TotalReviews</span>
        </div>
        <p class="text-blue-100 font-semibold">Total Reviews</p>
    </div>

    <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 shadow-lg">
        <div class="flex items-center justify-between mb-2">
            <i class="fas fa-comment-dots text-3xl text-white opacity-75"></i>
            <span class="text-4xl font-bold text-white">@Model.ReviewsWithComments</span>
        </div>
        <p class="text-purple-100 font-semibold">With Comments</p>
    </div>

    <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 shadow-lg">
        <div class="flex items-center justify-between mb-2">
            <i class="fas fa-text-width text-3xl text-white opacity-75"></i>
            <span class="text-4xl font-bold text-white">@Model.AverageReviewLength</span>
        </div>
        <p class="text-green-100 font-semibold">Avg. Comment Length</p>
    </div>
</div>

<!-- Reviews Per Month Chart -->
<div class="bg-gray-800 rounded-xl p-6 mb-8 border border-gray-700">
    <h3 class="text-2xl font-bold text-white mb-6">
        <i class="fas fa-chart-line text-blue-400 mr-2"></i>
        Reviews Per Month (Last 12 Months)
    </h3>
    <div class="h-64">
        <canvas id="reviewsPerMonthChart"></canvas>
    </div>
</div>

<!-- Rating Distribution -->
<div class="bg-gray-800 rounded-xl p-6 mb-8 border border-gray-700">
    <h3 class="text-2xl font-bold text-white mb-6">
        <i class="fas fa-star text-yellow-400 mr-2"></i>
        Rating Distribution (1-10)
    </h3>
    <div class="h-80">
        <canvas id="ratingDistributionChart"></canvas>
    </div>
</div>

<!-- Most Reviewed Content -->
<div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
    <h3 class="text-2xl font-bold text-white mb-6">
        <i class="fas fa-fire text-red-400 mr-2"></i>
        Most Reviewed Content
    </h3>

    @if (Model.MostReviewedContent.Any())
    {
        <div class="space-y-4">
            @foreach (var content in Model.MostReviewedContent)
            {
                <div class="bg-gray-700 rounded-lg p-4 flex items-center justify-between">
                    <div class="flex-1">
                        <p class="text-white font-bold text-lg">@content.ContentTitle</p>
                        <div class="flex items-center gap-4 mt-1">
                            <span class="text-gray-400 text-sm">
                                <i class="fas fa-comments mr-1"></i>@content.ReviewCount reviews
                            </span>
                            <span class="text-yellow-400 font-semibold">
                                <i class="fas fa-star mr-1"></i>@content.AverageRating.ToString("F1") avg
                            </span>
                        </div>
                    </div>
                    <div class="w-32">
                        <div class="w-full bg-gray-600 rounded-full h-3">
                            @{
                                var percentage = (content.ReviewCount / (double)Model.MostReviewedContent.Max(c => c.ReviewCount)) * 100;
                            }
                            <div class="bg-gradient-to-r from-blue-400 to-blue-500 h-3 rounded-full transition-all"
                                 style="width: @percentage%"></div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <p class="text-gray-400 text-center py-8">No data available</p>
    }
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Reviews Per Month Chart
        const monthlyCtx = document.getElementById('reviewsPerMonthChart').getContext('2d');
        new Chart(monthlyCtx, {
            type: 'line',
            data: {
                labels: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ReviewsPerMonth.Select(r => r.Month))),
                datasets: [{
                    label: 'Reviews',
                    data: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ReviewsPerMonth.Select(r => r.Count))),
                    borderColor: 'rgb(59, 130, 246)',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { color: '#fff' }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { color: '#9CA3AF' },
                        grid: { color: '#374151' }
                    },
                    x: {
                        ticks: { color: '#9CA3AF' },
                        grid: { color: '#374151' }
                    }
                }
            }
        });

        // Rating Distribution Chart
        const ratingCtx = document.getElementById('ratingDistributionChart').getContext('2d');
        new Chart(ratingCtx, {
            type: 'bar',
            data: {
                labels: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.RatingDistribution.Select(r => r.Rating + "/10"))),
                datasets: [{
                    label: 'Number of Reviews',
                    data: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.RatingDistribution.Select(r => r.Count))),
                    backgroundColor: [
                        '#EF4444', '#F97316', '#F59E0B', '#EAB308', '#84CC16',
                        '#22C55E', '#10B981', '#14B8A6', '#06B6D4', '#3B82F6'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { color: '#fff' }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { color: '#9CA3AF' },
                        grid: { color: '#374151' }
                    },
                    x: {
                        ticks: { color: '#9CA3AF' },
                        grid: { display: false }
                    }
                }
            }
        });
    </script>
}